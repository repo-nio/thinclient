<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nixxis Client v3</title>
    <link rel="stylesheet" href="./jsTools/calendar-v3/calendar-style-v3.css" />
    <link rel="stylesheet" href="./v3/assets/css/style.css" />
    <!-- <link rel="stylesheet" href="./assets/css/modals.css"> -->
    <script src="./assets/js/jquery.min.js"></script>
    <script defer src="./v3/assets/js/modals.js"></script>
    <link rel="icon" type="image/png" href="./favicon.png" />


    <!-- <script type="text/javascript" src="jsTools/jscalendar-1.0/calendar.js"></script> -->
    <script defer src="jsTools/calendar-v3/calendar-v3.js"></script>
    <!-- <script type="text/javascript" src="jsTools/jscalendar-1.0/lang/calendar-fr.js"></script> -->
    <script type="text/javascript" language="javascript" src="jsAgent/AgentLanguageResource.js"></script>
    <!-- <script type="text/javascript" language="javascript" src="jsAgent/agentConst.js"></script> -->
    <script type="text/javascript" language="javascript" src="tools.js"></script>
    <script type="text/javascript" language="javascript" src="JsCommon/NixxisCommonFn.js"></script>
    <script type="text/javascript" language="javascript" src="link.js"></script>
    <script type="text/javascript" language="javascript" src="toolbar.js"></script>		
    <script type="text/javascript" language="javascript" src="CrToolbox/CrToolbox.js"></script>
    <script type="text/javascript" language="javascript" src="CrToolbox/CrToolboxControl.js"></script>
    <script type="text/javascript" language="javascript" src="CrToolbox/CrToolboxControlVisual.js"></script>
    <script type="text/javascript" language="javascript" src="jsTools/dbgWindow.js"></script>
    <!-- <link rel="stylesheet" href="jsTools/jscalendar-1.0/calendar-v3.css"></script> -->
    <script type="text/javascript" language="javascript" src="jsCommon/NixxisCommonObj.js"></script>
    <script type="text/javascript" language="javascript" src="jsAgent/agentPanels.js"></script>
    <script type="text/javascript" language="javascript" src="jsAgent/agentWindowCfg.js"></script>
    <script type="text/javascript" language="javascript" src="./assets/js/V3Functions.js"></script>
    <script defer src="https://code.iconify.design/3/3.1.0/iconify.min.js" ></script>
    <!-- <script defer src="./assets/js/modals.js"></script> -->
    <script type="text/javascript" language="javascript">
      var ClientLink;
      
      function initInstance()
      {
        // debugger;

        window.document.title = "Nixxis agent desktop " + const_AgentVersionDisplay;

        // OnToolboxResize.Add(this, pageResize);
        crLoadingScreen.crLoadingMsg = CrResource.Common.LoadingMsg;
        crLoadingScreen.Init();
        crLoadingScreen.Visible(true);
        
        if (const_Debug) dbgStartWindow();
        
        ClientLink = new NixxisClientLink;
        
        ClientLink.linkToolStrip_V3($("AgentToolStrip"));
        ClientLink.linkToolStrip_V3($("VoiceToolStrip"));
        // ClientLink.linkToolStrip_V3($("ChatToolStrip"));
        // ClientLink.linkToolStrip_V3($("MailToolStrip"));
        
        // debugger;
        setToolStripLanguage_V3($('AgentToolStrip'));
        setToolStripLanguage_V3($('VoiceToolStrip'));
        // setToolStripLanguage($('MailToolStrip'));
        // setToolStripLanguage($('ChatToolStrip'));
  
        setToolStripConfiguration($('AgentToolStrip'));
        setToolStripConfiguration($('VoiceToolStrip'));
        // setToolStripConfiguration($('MailToolStrip'));
        // setToolStripConfiguration($('ChatToolStrip'));
        
        
        DebugLog("Init window...");
        
        Init_Window();
        pageResize();
  
        if (const_DebugToolbar) SetDebug(true);

        ClientConnect();
        // window.setTimeout("ClientConnect();", 0, "javascript");
        
        // debugger;
        document.body.nextSibling;
      }

      function exitInstance()
      {
          // sessionStorage.removeItem('reloadedOn');
          localStorage.setItem("NixxisAgentLoginUser", '');
        if (sessionStorage.getItem('reloadedOn') == null) 
        {
          console.log('page was not reloaded');

          try
          {			
            ClientLink.disconnect();
            DisposeClient();
            ClientLink.dispose();
            ClientLink = null;				
          }
          catch(e)
          {
            ;
          }
        }

        sessionStorage.setItem('reloadedOn', new Date());
      }
  
      function onBeforeUnloadAction()
      {
        // debugger;
        // ForceBreakOnAgentReload();
        return "Do you want to logout?";
      }
       
      window.onbeforeunload = function(e)
      {
        debugger;

        // return;
        
        if(document.activeElement && (document.activeElement.id == 'btnAgentLogoutOk'
          || document.activeElement.lastElementChild.id == 'AgentLogout'))
        {
          console.info( "onbeforeunload" );
        }
        else
        {
          // e.preventDefault();
          // var clickResponse = crAgentReloadWarning.Show();


          // if(!crAgentReloadWarning.crFormActionCancelled)
          // {
          //   location.reload();
          // }
          
          return onBeforeUnloadAction();
        }
      }
      </script>
  </head>

  <body onload="javascript: initInstance();" onunload="javascript: exitInstance();">
    <div id="app">
      <div class="flex v" style="display: flex; flex: 1; flex-direction: column; height: 100vh" >
        <div id="content" class="resize-div" style="height: calc(100% - 144px)">
          <div class="masterTab" id="masterTab" style="display:none;">
          </div>
          <object data="./embed.html" type="text/html" id="contactViewerObject" style="pointer-events: none; height: 100%; width: 100%"></object>
        </div>

        <flex-resizer id="resize-1" class="flexLine" style="cursor: ns-resize" ></flex-resizer>
        
        <div id="footerMain" class="footer-main resize-div" style="flex: 1">
          <div class="footer" id="footer-child">
            <div class="flex h" style="overflow: unset; flex: 1; width: 100%">
              <!-- Buttons -->
              <div class="flex-item column grid-buttons resize-div" style="padding: 0px 5px; min-width: 100px; width: 25%"
                   id="bottom-left">
                   <button class="resetBtn resetBtnBoxOne ovl-btn" id="resetBtn-1">
                    <span class="right iconify" data-icon="material-symbols:play-arrow" data-width="24"
                          data-height="24" style="color: #bfbfbf; margin-left: -20px"></span>
                  </button>

                <div class="grid-wrapper " id="AgentToolStrip">

                  <!-- Mini mode -->
                  <button class="btn-1" data-mode="#modalAgentLogout" id="AgentLogout" data-target="#logout">
                    <div class="icon">
                      <img src="./assets/icons/General_ApplicationChooser_50.png" alt="icon"
                          class="NixxisButton" id="AgentLogout"/>              
                    </div>
                    <span id="AgentLogout">Logout</span>
                  </button>

                  <!-- Quit -->
                  <!-- <button class="btn-1">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_AddressBookEntryType_Agent_Off_25.png" alt="icon"
                        class="NixxisButton" id="CloseScript" />
                      />
                    </div>
                    <span id="CloseScript">Quit</span>
                  </button> -->

                  <!-- Ready -->

                  <!-- data-switch="ready" -->
                  <button class="btn-1" data-switch="ready" id="WaitForCall" data-keep-target="#ready" data-target="#break">
                    <div class="icon">
                      <img src="./assets/icons/Agent_Command_Ready_50.png" alt="icon" 
                          class="NixxisButton" id="WaitForCall"/>
                    </div>
                    <span id="WaitForCall">Ready</span>
                  </button>

                  <!-- Break -->

                  <button class="btn-1" data-switch="break" id="Pause" data-target="#break">
                    <div class="icon">
                      <img src="./assets/icons/Agent_Command_Pause_50.png" alt="icon"
                          class="NixxisButton" id="Pause" />
                    </div>
                    <span id="Pause">Break</span>
                  </button>

                  <!-- Priority picker -->
                  <button class="btn-1" id="PriorityPickup" data-keep-target="#priority-picker">
                    <div class="icon">
                      <img src="./assets/icons/Agent_Command_PriorityPickup_50.png" alt="icon"
                          class="NixxisButton" id="PriorityPickup" />
                    </div>
                    <span id="PriorityPickup">Priority pickup</span>
                  </button>

                  <!-- Search mode -->
                  <button class="btn-1" data-target="#search-mode" id="SearchMode">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_StartSearchMode_50.png" alt="icon"
                        class="NixxisButton" id="SearchMode"
                      />
                    </div>
                    <span id="SearchMode">Search mode</span>
                  </button>

                  <!-- Manual dial -->
                  <button class="btn-1" data-target="#dial-pad" id="VoiceNewCall">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_Voice_NewCall_50.png" alt="icon"
                        class="NixxisButton" id="VoiceNewCall"
                      />
                    </div>
                    <span id="VoiceNewCall">Manual dial</span>
                  </button>

                  <!-- Team -->
                  <button class="btn-1" data-target="#team" id="TeamSelection">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_SelectTeam_50.png" alt="icon"
                        class="NixxisButton" id="TeamSelection"
                      />
                    </div>
                    <span id="TeamSelection">Team</span>
                  </button>

                  <!-- Send alert -->
                  <!-- <button class="btn-1" id="RequestAssistance">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_SendAlert_50.png" alt="icon"
                        class="NixxisButton" id="RequestAssistance"
                      />
                    </div>
                    <span id="RequestAssistance">Send alert</span>
                  </button> -->

                  <button class="collapseBtn">
                    <span class="iconify" data-icon="material-symbols:play-arrow" data-width="24" data-height="24"
                          data-rotate="180deg" style="color: #bfbfbf" ></span>
                  </button>
                </div>
                <div class="bg_w" style="background-color: #333; position: absolute; bottom: 0; width: 100%; content: '';"></div>
              </div>
              <flex-resizer style="width: 2px;" id="rs-1"></flex-resizer>

              <!-- Voice Buttons -->
              <div class="flex-item column grid-buttons resize-div" style="padding: 0px 5px; min-width: 100px; width: 25%"
                   id="bottom-middle-left">
                <button class="resetBtn resetBtnBoxOne ovl-btn" id="resetBtn-2">
                  <span class="right iconify" data-icon="material-symbols:play-arrow" data-width="24" data-height="24"
                        style="color: #bfbfbf; margin-left: -20px"></span>
                </button>
                <div class="grid-wrapper " id="VoiceToolStrip" style="display: none;">
                  <!-- Disposition -->
                  <!-- data-target="#disposition" -->
                  <button class="btn-1" data-target="#Select-qual" id="Selectqual">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_SetQualification_50.png" alt="icon"
                        class="NixxisButton" id="Selectqual"
                      />
                    </div>
                    <span id="Selectqual">Disposition</span>
                  </button>          

                  <!-- Extend -->
                  <button class="btn-1" id="ExtendWrapup" style="display:none;">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_ExtendTime_50.png" alt="icon"
                        class="NixxisButton" id="ExtendWrapup"
                      />
                    </div>
                    <span id="ExtendWrapup">Extend</span>
                  </button>

                  <!-- Close -->
                  <button class="btn-1" id="CloseScript">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_CloseScript_50.png" alt="icon"
                        class="NixxisButton" id="CloseScript"
                      />
                    </div>
                    <span id="CloseScript">Close</span>
                  </button>

                  <!-- Hold -->
                  <button class="btn-1" id="VoiceHold">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_Voice_Hold_50.png" alt="icon"
                        class="NixxisButton" id="VoiceHold"
                      />
                    </div>
                    <span id="VoiceHold">Hold</span>
                  </button>

                  <!-- Retrieve -->
                  <button class="btn-1" id="VoiceRetrieve">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_Voice_Retrieve_50.png" alt="icon"
                        class="NixxisButton" id="VoiceRetrieve"
                      />
                    </div>
                    <span id="VoiceRetrieve">Retrieve</span>
                  </button>
                
                  <!-- Forward -->
                  <button class="btn-1" id="VoiceForward">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_Voice_Forward_50.png" alt="icon"
                        class="NixxisButton" id="VoiceForward"
                      />
                    </div>
                    <span id="VoiceForward">Forward</span>
                  </button>

                  <!-- Transfer -->
                  <button class="btn-1" id="VoiceTransfer">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_Voice_Transfer_50.png" alt="icon"
                        class="NixxisButton" id="VoiceTransfer"
                      />
                    </div>
                    <span id="VoiceTransfer">Transfer</span>
                  </button>

                  <!-- Conference -->
                  <button class="btn-1" id="VoiceConference">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_Voice_Conference_50.png" alt="icon"
                        class="NixxisButton" id="VoiceConference"
                      />
                    </div>
                    <span id="VoiceConference">Conference</span>
                  </button>

                  <!-- Hangup -->
                  <button class="btn-1" id="VoiceHangup">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_Voice_Hangup_50.png" alt="icon"
                        class="NixxisButton" id="VoiceHangup"
                      />
                    </div>
                    <span id="VoiceHangup">Hangup</span>
                  </button>

                  <!-- Record -->
                  <button class="btn-1" id="VoiceRecord">
                    <div class="icon">
                      <img
                        src="./assets/icons/Agent_Command_Voice_Record_50.png" alt="icon"
                        class="NixxisButton" id="VoiceRecord"
                      />
                    </div>
                    <span id="VoiceRecord">Record</span>
                  </button>

                  <button class="collapseBtn">
                    <span class="iconify" data-icon="material-symbols:play-arrow" data-width="24" data-height="24"
                          data-rotate="180deg" style="color: #bfbfbf" ></span>
                  </button>
                </div>
                <div class="bg_w" style=" background-color: #333; position: absolute; bottom: 0; width: 100%; content: '';"></div>
              </div>
              <flex-resizer style="width: 2px;" id="rs-2"></flex-resizer>

              <!-- Active Contact Status -->
              <div class="flex-item column when-ready resize-div statusBox" id="bottom-middle-right" > <!-- id="voiceStatusToolStrip"  -->
                <button class="resetBtn resetBtnBoxOne" id="resetBtn-3">
                  <span class="right iconify" data-icon="material-symbols:play-arrow" data-width="24" data-height="24"
                        style="color: #bfbfbf; margin-left: -20px" ></span>
                </button>

                <div class="when-ready" id="statusBox-gird">

                </div>

                <button class="collapseBtn-3 resetBtn resetBtnBoxOne" style="z-index: 10000; right: -8px" >
                  <span class="right iconify" data-icon="material-symbols:play-arrow" data-width="24" data-height="24"
                        data-rotate="180deg" style="color: #bfbfbf; margin-left: -20px" ></span>
                </button>
              </div>

              <flex-resizer style="width: 2px;" id="rs-3"></flex-resizer>

              <!-- Agent Info Panel --> 
              <div class="column resize-div" id="bottom-right">

                <ul id="txPropertyGrid_AgentInfo" class="txPropertyGrid" style="display:none;"></ul>
                <li id="PropertyGridCat_Agent" Class="txPropertyGridCategory" style="display:none;"><script>document.writeln(CrResource.infoBox.titleAgt);</script></li>
                <li id="PropertyGridCat_Queue" Class="txPropertyGridCategory" style="display:none;"><script>document.writeln(CrResource.infoBox.titleQueue);</script></li>
                <li id="PropertyGridCat_Contact" Class="txPropertyGridCategory" style="display:none;"><script>document.writeln(CrResource.infoBox.titleContact);</script></li>
                <div id="NixxisAgentContactArea" class="NixxisAgentContactArea" style="display:none;"> </div> 

                <div class="view" id="divAgentStatus">
                  <table class="table" style="color: #c2c2c2;">
                    <tr class="row">
                      <td><span class="label" id="Info_QueueWaitingHeader">Waiting contacts:</span></td>
                      <td><span class="value" id="Info_QueueWaiting">0</span></td>
                    </tr>
                    <tr class="row">
                      <td><span class="label" id="Info_QueueHighPriorityHeader">Priority contacts:</span></td>
                      <td><span class="value" id="Info_QueueHighPriority">0 - 0</span></td>
                    </tr>
                    <tr class="row">
                      <td><span class="label" id="Info_AgentStateHeader">State:</span></td>
                      <td><span class="value" id="Info_AgentState">Break</span></td>
                    </tr>
                    <tr class="row">
                      <td><span class="label" id="Info_AgentSessionDurationHeader">Duration:</span></td>
                      <td><span class="value" id="Info_AgentSessionDuration">00:00:00</span></td>
                    </tr>
                    <tr class="row">
                      <td><span id="Info_AgtName_Account"></span></td>
                      <td>
                        <div class="d-flex">
                          <button class="btn-2">
                          <img src="./assets/icons/Agent_ReadyVoiceIndication_25.png" alt="icon" id="Info_AgentReadyVoiceIndication"
                              class="NixxisButton"/>
                          </button>
                        <button class="btn-2" style="display:none;">                    
                          <img src="./assets/icons/Agent_ReadyChatIndication_25.png" alt="icon" id="Info_AgentReadyChatIndication"
                              class="NixxisButton"/>
                          </button>
                        <button class="btn-2" style="display:none;">
                          <img src="./assets/icons/Agent_ReadyMailIndication_25.png" alt="icon" id="Info_AgentReadyMailIndication"
                              class="NixxisButton"/>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>

                <div class="WarningView" id="divWarningView" style="display: none;">
                  <ul id="liWarningView"></ul>
                </div>
              </div>

            </div>
          </div>

          
        </div>

        <div class="hide" id="rightClickContextMenu">
          <ul>
              <li>
                  <button class="active" id="btnAgentViewOptionStatus"><i class="fa fa-check"></i> <span>Status View</span></button>
              </li>
              <li>
                  <button id="btnAgentViewOptionWarningMessage"><i class="fa fa-check"></i> <span>Warning messages</span></button>
              </li>
          </ul>
        </div>

        <div id="exit-modal" onclick="exitModal()"></div>
        <div id="first-modal" onclick="showModal('first')"></div>
        <div id="second-modal" onclick="showModal('second')"></div>
      </div>
    </div>

    <div class="backdrop" id="backdrop"></div>
    <div id="overlay-modal" style="position: fixed; height: 100%; width: 100%; z-index: -1" ></div>
    <!-- <script src="./assets/js/CrToolbox.js"></script> -->
    <script src="./assets/js/script.js"></script>
  </body>
</html>
