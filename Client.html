<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>ContactRoute Desktop Parent Window</title>
		<script type="text/javascript" language="javascript" src="tools.js"></script>
		<script type="text/javascript" language="javascript">
		    var ClientLink;
		    
		    function initPage()
		    {
//		        document.domain = document.domain.substring(document.domain.lastIndexOf('.', document.domain.lastIndexOf('.') - 1) + 1);
		        
		        var toolbarLocation = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1) + 'toolbar.html';
		        
		        document.getElementById('NixxisAgent').src = toolbarLocation;
		    }
		    
		    function exitPage()
		    {
		        try
		        {
		            ClientLink.disconnect();
		        }
		        catch(e)
		        {
		            ;
		        }
		    }
		    
		    function ClientInitialized(clientLink)
		    {
		        ClientLink = clientLink;
		        
		        ClientLink.ContactAdded.Add(this, onContactAdded);
		        ClientLink.ContactStateChanged.Add(this, onContactStateChanged);
		        
		        document.getElementById('Application').src = 'SampleContent.htm';
		    }
		    
		    function ConnectClient(userId, password)
		    {
		        ClientLink.connect(userId, password);
		    }
		    function LoginClient(userId, password, extension)
		    {
		        ClientLink.connect(userId, password, extension);
		    }		    
		    function WaitForCall()
		    {
		        ClientLink.commands.WaitForCall.execute();
		    }
		    
		    function ClientDisposing(clientLink)
		    {
		        ClientLink.ContactAdded.Remove(this, onContactAdded);
		        ClientLink.ContactStateChanged.Remove(this, onContactStateChanged);
		        
		        ClientLink = null;
		    }
		    
		    function onContactAdded(contactInfo)
		    {
            }
            
            function onContactStateChanged(contactInfo)
            {
                if((contactInfo.State == 'A' && !ClientLink.Contacts.ActiveContactId) || contactInfo.State == 'C')
                {
                    ClientLink.SetActiveContact(contactInfo);
                    
                    try
                    {
                        document.getElementById('Application').OnContactConnected(contactInfo);
                    }
                    catch(e)
                    {
                        ;
                    }
                }
                else if(contactInfo.State == 'D')
                {
                    try
                    {
                        document.getElementById('Application').OnContactDisconnected(contactInfo);
                    }
                    catch(e)
                    {
                        ;
                    }

                    ClientLink.TerminateContact(contactInfo);
                }
            }
		</script>
	</head>
	<body onload="javascript:initPage()" onunload="javascript:exitPage()">
	<div style="height: 100%">
	    <iframe id="NixxisAgent" width="100%" height="40px" frameborder="0" scrolling="no"></iframe>
	    <iframe id="Application" width="100%" height="500px" frameborder="0" scrolling="auto"></iframe>
	</div>
	</body>
</html>
