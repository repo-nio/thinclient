<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Nixxis Supervisor navigator window</title>
		<link rel="stylesheet" href="default.css" />
		<script type="text/javascript" language="javascript" src="JsCommon/NixxisCommonFn.js"></script>
		<script type="text/javascript" language="javascript" src="CrToolbox/CrToolbox.js"></script>
		<script type="text/javascript" language="javascript" src="CrToolbox/CrToolboxControl.js"></script>
        <script type="text/javascript" language="javascript" src="CrToolbox/CrToolboxControlVisual.js"></script>
		<script type="text/javascript" language="javascript" src="JsCommon/NixxisCommonObj.js"></script>
		<script type="text/javascript" language="javascript" src="js/supervisionLanguageResource.js"></script>
		<script type="text/javascript" language="javascript" src="tools.js"></script>
		<script type="text/javascript" language="javascript">
		    var ClientLink;
		    function initPage()
		    {
<!IS_BROWSER Firefox>
		        try { document.domain = document.domain.substring(document.domain.lastIndexOf('.', document.domain.lastIndexOf('.') - 1) + 1); }
				catch(e) {}
				//alert("CrAgent.htm: " + document.domain);
<!IS_BROWSER>	
				
				crLoadingScreen.crLoadingMsg = CrResource.Common.LoadingMsg;
				crLoadingScreen.Init();
				crLoadingScreen.Visible(true);
				
		        var toolbarLocation = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1) + 'toolbar_sup.html';
		        document.getElementById('NixxisAgent').src = toolbarLocation;
		        //window.onmousemove = function() { console.log("onmousemove"); };
		        
		    }
		    
		    function exitPage()
		    {
		        ClientLink.disconnect();
		    }
		    
		    function ClientInitialized(clientLink)
		    {
		        ClientLink = clientLink;
		        
		        ClientLink.ContactAdded.Add(this, onContactAdded);
		        ClientLink.ContactStateChanged.Add(this, onContactStateChanged);

		        window.setTimeout("ClientLogin();", 3000, "javascript");
		    }
		    function SaveApp()
		    {
		        ClientLink.saveData("47b886e8334d482ca02efa61ed8af615", "TestSave" );
		    }
		    function LoadApp()
		    {
		        alert(ClientLink.loadData("47b886e8334d482ca02efa61ed8af615"));
		    }
		    
			
		    function ClientLogin()
		    {
		        //ClientLink.connect('101', '101');
		        ClientLink.connect();
				crLoadingScreen.Visible(false);     	    
		    }
		    
		    function ConnectClient(userId, password)
		    {
		        //ClientLink.connect(userId, password);
		    }
		    
		    
		    function ClientDisposing(clientLink)
		    {
		        ClientLink.ContactAdded.Remove(this, onContactAdded);
		        ClientLink.ContactStateChanged.Remove(this, onContactStateChanged);
		        
		        ClientLink = null;
		    }
		    
		    function onContactAdded(contactInfo)
		    {
		        //alert("ContactAdd: " + contactInfo);
            }
            
            function onContactStateChanged(contactInfo)
            {
                //alert("StateChanged: " + contactInfo); 
                if((contactInfo.State == 'A' && !ClientLink.Contacts.ActiveContactId) || contactInfo.State == 'C')
                {
                    ClientLink.SetActiveContact(contactInfo);
                    
                    try
                    {
                        document.getElementById('Application').OnContactConnected(contactInfo);
                    }
                    catch(e)
                    {
                        ;
                    }
                }
                else if(contactInfo.State == 'D')
                {
                    try
                    {
                        document.getElementById('Application').OnContactDisconnected(contactInfo);
                    }
                    catch(e)
                    {
                        ;
                    }

                    ClientLink.TerminateContact(contactInfo);
                }
            }
            function onSupervisionData(data)
            {
                debugger;
            }
		</script>
	</head>
	<body id="MainBody" onload="javascript:initPage();" onunload="javascript:exitPage()" style="background-image: url(img/Dashboard_Background.png); background-position:bottom">
	<div style="height: 100%; background-color:Transparent;">
	    <iframe id="NixxisAgent" width="100%" height="830px" frameborder="0" scrolling="no" allowtransparency="true" style="background-color:Transparent"></iframe>
-	</div>
	</body>
</html>
